<!doctype html>
<html lang="en"><meta charset="utf-8" />
<title>Upcoming Primary Completions (12m)</title>
<style>
  body{font:14px/1.4 system-ui, sans-serif;margin:16px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px 10px;border-bottom:1px solid #ddd;text-align:left}
  th{position:sticky;top:0;background:#f8f8f8}
  .muted{color:#666;font-size:12px;margin:8px 0 12px}
</style>
<div class="muted" id="meta">Loading…</div>
<table id="tbl">
  <thead><tr>
    <th>NCT ID</th><th>Title</th><th>Phase</th><th>Status</th>
    <th>Primary Completion</th><th>Lead Sponsor</th><th>Enrollment</th>
  </tr></thead>
  <tbody></tbody>
</table>
<script>
(async () => {
  const url = "https://lorago92.github.io/aact-dashboard/upcoming_12m.json?ts=" + Date.now(); // ABSOLUTE URL
  try {
    const res = await fetch(url);
    if (!res.ok){ document.getElementById('meta').textContent="Failed to load: " + res.status; return; }
    const { meta, data } = await res.json();
    if (!Array.isArray(data) || data.length === 0){ document.getElementById('meta').textContent="No upcoming studies in the next 12 months."; return; }

    const fmt = d => d ? new Date(d).toISOString().slice(0,10) : "";
    document.getElementById('meta').textContent =
      "Upcoming Primary Completions (12m) — As of " + meta.as_of_utc + " · " + data.length + " studies";
    const tbody = document.querySelector("#tbl tbody");
    data.forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML =
        `<td><a href="https://clinicaltrials.gov/study/${r.nct_id}" target="_blank" rel="noopener">${r.nct_id}</a></td>
         <td>${(r.title||"").replace(/</g,"&lt;")}</td>
         <td>${r.phase_std||""}</td>
         <td>${r.overall_status||""}</td>
         <td>${fmt(r.primary_completion_date)} ${r.primary_completion_date_type ? '('+r.primary_completion_date_type+')' : ''}</td>
         <td>${r.lead_sponsor||""}</td>
         <td>${r.enrollment ?? ""}</td>`;
      tbody.appendChild(tr);
    });
  } catch(e){
    document.getElementById('meta').textContent = "Error: " + e;
  }
})();
</script>
</html>
